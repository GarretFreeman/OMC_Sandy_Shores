<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculatrice de soins — OMC Nord (USD)</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --panel-2:#0b1223;     /* darker */
      --text:#e5e7eb;        /* gray-200 */
      --muted:#9ca3af;       /* gray-400 */
      --primary:#38bdf8;     /* sky-400 */
      --accent:#22c55e;      /* green-500 */
      --danger:#ef4444;      /* red-500 */
      --border:#1f2937;      /* gray-800 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 80% -20%, #123 0%, transparent 50%),
               radial-gradient(900px 500px at -20% 0%, #0b1a2a 0%, transparent 60%),
               var(--bg);
      color:var(--text); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
    }
    .container{max-width:1100px; margin:40px auto; padding:0 20px}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:10px}
    .title{display:flex; align-items:center; gap:12px}
    .logo{width:42px; height:42px; border-radius:12px; background:linear-gradient(135deg, var(--primary), #60a5fa); display:grid; place-items:center; font-weight:800; color:#00111a}
    h1{margin:0; font-size:clamp(20px, 3vw, 28px)}
    .muted{color:var(--muted)}

    .card{background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgb(0 0 0 / .25)}
    .grid{display:grid; grid-template-columns:1.2fr .8fr; gap:20px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .section{padding:18px}

    /* Tabs */
    .tabs{display:flex; gap:12px; flex-wrap:wrap; margin:14px auto 20px; justify-content:center; padding:10px; background:rgba(15,23,42,.5); border:1px solid var(--border); border-radius:16px; backdrop-filter:saturate(1.2) blur(6px); box-shadow:0 8px 24px rgba(0,0,0,.3); max-width:fit-content}
    .tab{appearance:none; border:1px solid var(--border); background:#0b1223; color:var(--text); padding:8px 12px; border-radius:14px; cursor:pointer; display:grid; place-items:center; gap:6px; transition:filter .15s ease, transform .05s ease}
    .tab:hover{filter:brightness(1.1)}
    .tab:active{transform:translateY(1px)}
    .tab svg{width:22px; height:22px}
    .tab-caption{font-size:12px; line-height:1; color:var(--muted)}
    .tab[aria-selected="true"]{background:linear-gradient(180deg, #0ea5e9, #0284c7); color:#001019; border-color:#0369a1; box-shadow:0 6px 16px rgb(2 132 199 / .45)}
    .tab[aria-selected="true"] .tab-caption{color:#001019; font-weight:700}

    .list{max-height:520px; overflow:auto; padding:6px}
    .item{display:grid; grid-template-columns:1fr auto auto; align-items:center; gap:12px; padding:10px 12px; border:1px dashed transparent; border-radius:12px}
    .item + .item{margin-top:8px}
    .item:hover{background:#0c1529; border-color:#16223c}
    .pill{font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:#cbd5e1}

    .qty{display:flex; align-items:center; gap:6px}
    .qty input{width:56px; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#0b1223; color:#var(--text); text-align:center}
    .btn{appearance:none; border:none; padding:10px 14px; border-radius:12px; background:#0e172a; color:var(--text); border:1px solid var(--border); cursor:pointer}
    .btn:hover{filter:brightness(1.1)}

    .totals{padding:18px; border-top:1px solid var(--border); display:grid; gap:10px}
    .totals .row{display:flex; justify-content:space-between; align-items:center}
    .total{font-size:28px; font-weight:800}

    .summary{white-space:pre-wrap; background:#0b1223; border:1px solid var(--border); border-radius:12px; padding:12px; min-height:120px}

    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,1,1); white-space:nowrap; border:0}

    @media print{ header, .tabs{display:none} body{background:#fff; color:#000} .card{border:none; box-shadow:none} .summary{background:#fff; border:none} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="logo">OMC</div>
        <div>
          <h1>Calculatrice de soins — OMC Nord</h1>
          <div class="muted">Sélectionnez les actes par catégorie, ajustez les quantités, obtenez le total. Aucune donnée n’est enregistrée. (USD)</div>
        </div>
      </div>
    </header>
    <div class="grid">
      <!-- Colonne gauche : catalogue -->
      <section class="card section">
        <!-- Onglets centrés au-dessus de la liste -->
        <div class="tabs" id="tabs" role="tablist" aria-label="Catégories de soins">
          <button class="tab" role="tab" aria-selected="true" data-cat="Administratif" title="Administratif">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <rect x="9" y="2" width="6" height="4" rx="1" ry="1"></rect>
              <path d="M9 4H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2"></path>
              <path d="M9 12h6M9 16h4"></path>
            </svg>
            <span class="tab-caption">Administratif</span>
          </button>
          <button class="tab" role="tab" aria-selected="false" data-cat="Transport" title="Transport">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M3 13V7a2 2 0 0 1 2-2h8v8H3Z"></path>
              <path d="M13 9h3.5L21 13v4a2 2 0 0 1-2 2h-1"></path>
              <circle cx="7" cy="19" r="2"></circle>
              <circle cx="17" cy="19" r="2"></circle>
              <path d="M6 10h4M8 8v4"></path>
            </svg>
            <span class="tab-caption">Transport</span>
          </button>
          <button class="tab" role="tab" aria-selected="false" data-cat="Soins Hôpital" title="Soins Hôpital">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <path d="M12 7v10M7 12h10"></path>
            </svg>
            <span class="tab-caption">Soins Hôpital</span>
          </button>
          <button class="tab" role="tab" aria-selected="false" data-cat="Soins sur site" title="Soins sur site">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M7 7V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1"></path>
              <rect x="3" y="7" width="18" height="14" rx="2"></rect>
              <path d="M12 11v6M9 14h6"></path>
            </svg>
            <span class="tab-caption">Soins sur site</span>
          </button>
        </div>

        <div id="list" class="list" aria-live="polite"></div>
      </section>

      <!-- Colonne droite : récap -->
      <section class="card section">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:6px">
          <h2 style="margin:0">Récapitulatif</h2>
          <div style="display:flex; gap:8px">
            <button class="btn" id="reset">Réinitialiser</button>
          </div>
        </div>
        <div id="summary" class="summary">— Aucun soin sélectionné —</div>

        <div class="totals">
          <div class="row"><span>Sous-total</span><strong id="subtotal">$0</strong></div>
          <div class="row muted"><span>Taxes (optionnelles)</span><span>
            <label style="display:inline-flex; align-items:center; gap:6px">
              <input type="checkbox" id="taxEnable"> TVA
            </label>
            <input type="number" id="taxRate" value="0" min="0" max="100" step="0.5" style="width:80px; margin-left:8px; padding:6px 8px; border-radius:8px; border:1px solid var(--border); background:#0b1223; color:#fff"> %</span></div>
          <div class="row"><span>Total</span><span class="total" id="total">$0</span></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ======== CATALOGUE (USD UNIQUEMENT) ========
    const CATALOG = [
      // Administratif
      { id:'CERT_TRAVAIL', name:'Certificat aptitude travail', priceUSD:225, category:'Administratif' },
      { id:'CERT_PPA',     name:'Certificat aptitude PPA',     priceUSD:6500, category:'Administratif' },
      // Transport
      { id:'AMBUL_LOCAL',  name:'Transport ambulance locale',  priceUSD:200, category:'Transport' },
      // Soins Hôpital
      { id:'HOP_SOIN',     name:'Soins',                       priceUSD:450, category:'Soins Hôpital' },
      { id:'HOP_REA',      name:'Réanimation',                 priceUSD:800, category:'Soins Hôpital' },
      { id:'HOP_RADIO',    name:'Radio de contrôle',           priceUSD:480, category:'Soins Hôpital' },
      { id:'HOP_SUTURE',   name:'Points de suture',            priceUSD:500, category:'Soins Hôpital' },
      // Soins sur site
      { id:'SITE_SOIN',    name:'Soins',                       priceUSD:800, category:'Soins sur site' },
      { id:'SITE_REA',     name:'Réanimation',                 priceUSD:450, category:'Soins sur site' },
    ];

    // ======== ÉTAT ========
    const state = new Map(); // id -> quantity
    let activeCategory = 'Administratif';

    // ======== INIT ========
    const els = {
      list: document.getElementById('list'),
      tabs: document.getElementById('tabs'),
      summary: document.getElementById('summary'),
      subtotal: document.getElementById('subtotal'),
      total: document.getElementById('total'),
      taxEnable: document.getElementById('taxEnable'),
      taxRate: document.getElementById('taxRate'),
      reset: document.getElementById('reset'),
    };

    const fmt = (n) => new Intl.NumberFormat('en-US', { style:'currency', currency: 'USD' }).format(n);

    function syncTabs(){
      for (const btn of els.tabs.querySelectorAll('.tab')) {
        btn.setAttribute('aria-selected', String(btn.dataset.cat === activeCategory));
      }
    }

    function renderList(){
      els.list.innerHTML='';
      CATALOG.filter(x => x.category === activeCategory).forEach(item => {
        const row = document.createElement('div');
        row.className = 'item';

        const left = document.createElement('div');
        left.innerHTML = `<div style="font-weight:600">${item.name}</div>
                          <div class="muted" style="font-size:13px">${item.id} · <span class="pill">${item.category}</span></div>`;

        const price = document.createElement('div');
        price.className = 'muted';
        price.textContent = fmt(item.priceUSD);

        const qty = document.createElement('div');
        qty.className = 'qty';
        const minus = document.createElement('button'); minus.className='btn'; minus.textContent='−';
        const input = document.createElement('input'); input.type='number'; input.min='0'; input.step='1';
        input.value = state.get(item.id) ?? 0;
        const plus = document.createElement('button'); plus.className='btn'; plus.textContent='+';

        minus.onclick = () => { const v=Math.max(0, (state.get(item.id)||0)-1); state.set(item.id, v); input.value=v; updateSummary(); };
        plus.onclick  = () => { const v=(state.get(item.id)||0)+1; state.set(item.id, v); input.value=v; updateSummary(); };
        input.oninput = () => { const v=Math.max(0, parseInt(input.value||'0',10)); state.set(item.id, v); input.value=v; updateSummary(); };

        qty.append(minus, input, plus);
        row.append(left, price, qty);
        els.list.appendChild(row);
      });
    }

    function compute(){
      let lines = [];
      let subtotal = 0;
      for(const item of CATALOG){
        const q = state.get(item.id)||0;
        if(!q) continue;
        const unit = item.priceUSD;
        const line = unit * q;
        subtotal += line;
        lines.push(`• ${item.name} × ${q} — ${fmt(line)} (${fmt(unit)}/u)`);
      }
      const taxEnabled = els.taxEnable.checked;
      const taxRate = Math.max(0, Number(els.taxRate.value||0));
      const taxValue = taxEnabled ? (subtotal * taxRate/100) : 0;
      const total = subtotal + taxValue;
      return { lines, subtotal, taxEnabled, taxRate, taxValue, total };
    }

    function updateSummary(){
      const {lines, subtotal, taxEnabled, taxRate, taxValue, total} = compute();
      els.summary.textContent = lines.length ? lines.join('\n') : '— Aucun soin sélectionné —';
      els.subtotal.textContent = fmt(subtotal);
      els.total.textContent = fmt(total);
      els.taxRate.disabled = !taxEnabled;
      els.taxRate.style.opacity = taxEnabled ? 1 : .6;
    }

    // === Événements ===
    // Tabs: délégation d'événements pour capter clics sur icônes/labels
    els.tabs.addEventListener('click', (e) => {
      const btn = e.target.closest('.tab');
      if (!btn) return;
      activeCategory = btn.dataset.cat;
      syncTabs();
      renderList();
      updateSummary();
    });

    els.taxEnable.addEventListener('change', updateSummary);
    els.taxRate.addEventListener('input', updateSummary);
    els.reset.addEventListener('click', ()=>{ state.clear(); updateSummary(); renderList(); });

    // === Kickoff ===
    syncTabs();
    renderList();
    updateSummary();

    // --- Self-tests (console) ---
    (function selfTest(){
      try{
        console.log('[OMC] Catégorie active au chargement:', activeCategory);
        const leftCount = CATALOG.filter(x=>x.category===activeCategory).length;
        if(leftCount===0){ console.warn('[OMC][TEST] Aucune entrée trouvée pour', activeCategory); }
        // Simule un switch de tab pour s'assurer que l'écouteur marche
        const transportBtn = Array.from(els.tabs.querySelectorAll('.tab')).find(b=>b.dataset.cat==='Transport');
        if(transportBtn){
          transportBtn.dispatchEvent(new Event('click', {bubbles:true}));
          // Revenir à la catégorie par défaut
          const adminBtn = Array.from(els.tabs.querySelectorAll('.tab')).find(b=>b.dataset.cat==='Administratif');
          if(adminBtn){ adminBtn.dispatchEvent(new Event('click', {bubbles:true})); }
        }
      }catch(err){
        console.error('[OMC][TEST] Échec self-test:', err);
      }
    })();
  </script>
</body>
</html>
